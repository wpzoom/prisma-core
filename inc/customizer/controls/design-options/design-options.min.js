!function(n){"use strict";wp.customize.controlConstructor["sinatra-design-options"]=wp.customize.Control.extend({ready:function(){var a,e=this,t=e.setting.get(),i=e.container.find(".popup-content");e.container.find(".sinatra-range-wrapper").each(function(){var a=n(this);a.rangeControl({id:e.params.id+"-"+a.data("option-id"),option:a.data("option-id"),value:t[a.data("options-id")],responsive:e.params.responsive,change:function(){e.update_value()}})}),e.container.find("input.sinatra-range-input").on("change keyup",function(){e.autocorrect_range_input_number(n(this),1e3,a)}).on("focusout",function(){e.autocorrect_range_input_number(n(this),0,a)}),e.container.on("change",'[data-option="background-type"], [data-option="gradient-type"]',function(){var a=n(this).attr("data-option");e.container.find('[data-dep-field="'+a+'"]').hide(),e.container.find('[data-dep-field="'+a+'"][data-dep-value="'+n(this).val()+'"]').show()}),e.container.find('[data-option="background-type"], [data-option="gradient-type"]').trigger("change"),e.container.on("color-updated",".sinatra-color-control",function(){e.update_value()}),e.container.on("change",".sinatra-select-wrapper",function(){e.update_value()}),e.container.find(".popup-link").on("click",function(){i.toggleClass("hidden"),n(this).toggleClass("active"),n(this).siblings(".reset-defaults").toggleClass("active"),n("body").on("click",o)});var o=function(a){n(a.target).closest(".customize-save-button-wrapper").length||e.container.has(n(a.target).closest(".popup-link")).length||e.container.has(n(a.target).closest(".popup-content")).length||i.hasClass("hidden")||n(a.target).closest(".reset-defaults").length||(i.addClass("hidden"),e.container.find(".popup-link").removeClass("active"),e.container.find(".reset-defaults").removeClass("active"),n("body").off("click",o))};e.container.find(".background-image-advanced").hide(),e.container.on("change",".background-repeat select",function(){e.update_value()}),e.container.on("change click",".background-size input",function(){e.update_value()}),e.container.on("change click",".background-attachment input",function(){e.update_value()}),e.container.on("click",".background-image-upload-button",function(a){n("body").off("click",o);var t=wp.media({multiple:!1,title:e.params.l10n.image.select_image,button:{text:e.params.l10n.image.use_image}}).open().on("select",function(){var a,i,c,r,d,s=t.state().get("selection").first().toJSON();a=_.isUndefined(s.sizes)?s.url:_.isUndefined(s.sizes.medium)?_.isUndefined(s.sizes.thumbnail)?_.isUndefined(s.sizes.full)?s.url:s.sizes.full.url:s.sizes.thumbnail.url:s.sizes.medium.url,i=s.url,c=s.id,s.width,s.height,""!==i&&(e.container.find(".background-image-advanced").show(),e.container.find(".advanced-settings").removeClass("hidden").addClass("up")),e.container.find('[data-option="background-image"]').val(i),e.container.find('[data-option="background-image-id"]').val(c),e.update_value(),r=e.container.find(".placeholder, .thumbnail"),d=e.container.find(".background-image-upload-remove-button"),r.length&&r.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+a+'" alt="" />'),d.length&&d.show(),setTimeout(function(){n("body").on("click",o)},100)});a.preventDefault()}),e.container.on("click",".background-image-upload-remove-button",function(n){var a,t;n.preventDefault(),e.container.find('[data-option="background-image"]').val(""),e.container.find('[data-option="background-image-id"]').val(""),e.update_value(),a=e.container.find(".placeholder, .thumbnail"),t=e.container.find(".background-image-upload-remove-button"),e.container.find(".background-image-advanced").hide(),e.container.find(".advanced-settings").addClass("hidden").removeClass("up"),a.length&&a.removeClass().addClass("placeholder").html(e.params.l10n.image.placeholder),t.length&&t.hide()}),e.container.on("click",".advanced-settings",function(a){n(this).toggleClass("up"),e.container.find(".background-image-advanced").toggle()}),e.container.on("click",".sinatra-spacing-linked",function(){var a=n(this);a.closest("ul").find(".spacing-input").removeClass("linked"),a.parent(".spacing-link-values").removeClass("unlinked")}),e.container.on("click",".sinatra-spacing-unlinked",function(){var a=n(this);a.closest("ul").find(".spacing-input").addClass("linked"),a.parent(".spacing-link-values").addClass("unlinked")}),e.container.on("input",".linked input",function(){var a=n(this).val();n(this).closest(".spacing-input").siblings(".linked").find("input").val(a).change()}),e.container.on("change input",".spacing-input input",function(){e.update_value()}),e.container.find(".reset-defaults").on("click",function(){var a,t;e.container.find("[data-option]").each(function(){a=n(this),"background-size"===(t=a.data("option"))||"background-attachment"===t?(a.prop("checked",!1),t in e.params.default&&e.params.default[t]===a.val()&&a.prop("checked",!0)):a.val(e.params.default[a.data("option")]).trigger("change")}),e.container.find(".background-image-upload-remove-button").click(),e.update_value()})},update_value:function(){var a,e={};this.container.find("[data-option]").each(function(){a=n(this).data("option"),e[a]="background-size"===a||"background-attachment"===a?n(this).is(":checked")?n(this).val():e[a]:n(this).val()}),this.setting.set(e)},autocorrect_range_input_number:function(n,a){var e=n,t=e.parent().find('input[type="range"]'),i=parseFloat(e.val()),o=parseFloat(t.find(".sinatra-reset-range").attr("data-reset_value")),c=parseFloat(e.attr("step")),r=parseFloat(e.attr("min")),d=parseFloat(e.attr("max"));clearTimeout(a),a=setTimeout(function(){if(isNaN(i))return e.val(o),void t.val(o).trigger("change");c>=1&&i%1!=0&&(i=Math.round(i),e.val(i),t.val(i).trigger("change")),i>d&&(e.val(d),t.val(d).trigger("change")),i<r&&(e.val(r),t.val(r).trigger("change"))},a),t.val(i).trigger("change"),this.update_value()}})}(jQuery);