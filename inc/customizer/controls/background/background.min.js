!function(e){wp.customize.controlConstructor["sinatra-background"]=wp.customize.Control.extend({ready:function(){"use strict";var a,n,t,i=this,r=i.setting._value;i.container.find(".background-image-advanced").hide(),i.container.on("change",".background-repeat select",function(){i.saveValue("background-repeat",e(this).val())}),i.container.on("change click",".background-size input",function(){i.saveValue("background-size",e(this).val())}),i.container.on("change click",".background-attachment input",function(){i.saveValue("background-attachment",e(this).val())}),i.container.on("click",".background-image-upload-button",function(e){var a=wp.media({multiple:!1,title:i.params.l10n.select_image,button:{text:i.params.l10n.use_image}}).open().on("select",function(){var e,n,t,r,o,u=a.state().get("selection").first().toJSON();e=_.isUndefined(u.sizes)?u.url:_.isUndefined(u.sizes.medium)?_.isUndefined(u.sizes.thumbnail)?_.isUndefined(u.sizes.full)?u.url:u.sizes.full.url:u.sizes.thumbnail.url:u.sizes.medium.url,n=u.url,t=u.id,u.width,u.height,""!==n&&(i.container.find(".background-image-advanced").show(),i.container.find(".advanced-settings").removeClass("hidden").addClass("up")),i.saveValue("background-image",n),i.saveValue("background-image-id",t),r=i.container.find(".placeholder, .thumbnail"),o=i.container.find(".background-image-upload-remove-button"),r.length&&r.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+e+'" alt="" />'),o.length&&o.show()});e.preventDefault()}),i.container.on("click",".background-image-upload-remove-button",function(e){var a,n;e.preventDefault(),i.saveValue("background-image",""),i.saveValue("background-image-id",""),a=i.container.find(".placeholder, .thumbnail"),n=i.container.find(".background-image-upload-remove-button"),i.container.find(".background-image-advanced").hide(),i.container.find(".advanced-settings").addClass("hidden").removeClass("up"),a.length&&a.removeClass().addClass("placeholder").html(i.params.l10n.placeholder),n.length&&n.hide()}),i.container.on("click",".advanced-settings",function(a){e(this).toggleClass("up"),i.container.find(".background-image-advanced").toggle()}),i.container.find("input.sinatra-range-input").on("change keyup",function(){i.autocorrect_range_input_number(e(this),1e3,t)}).on("focusout",function(){i.autocorrect_range_input_number(e(this),0,t)}),i.container.find("input[type=range]").on("mousedown",function(){a=e(this),n=a.parent().children(".sinatra-range-input"),r=a.attr("value"),n.val(r),a.mousemove(function(){r=a.attr("value"),n.val(r),clearTimeout(t),t=setTimeout(function(){i.saveValue(a.data("key"),r)},25)})})},saveValue:function(e,a){var n=this.setting.get();a!==(n=n||{})[e]&&((n=JSON.parse(JSON.stringify(n)))[e]=a,this.setting.set(n))},autocorrect_range_input_number:function(e,a){var n=e,t=n.parent().find('input[type="range"]'),i=parseFloat(n.val()),r=parseFloat(t.find(".sinatra-reset-range").attr("data-reset_value")),o=parseFloat(n.attr("step")),u=parseFloat(n.attr("min")),s=parseFloat(n.attr("max"));clearTimeout(a),a=setTimeout(function(){if(isNaN(i))return n.val(r),void t.val(r).trigger("change");o>=1&&i%1!=0&&(i=Math.round(i),n.val(i),t.val(i).trigger("change")),i>s&&(n.val(s),t.val(s).trigger("change")),i<u&&(n.val(u),t.val(u).trigger("change"))},a),t.val(i).trigger("change"),this.saveValue(t.data("key"),i)}})}(jQuery);